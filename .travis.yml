language: c++

# options common to all linux builds (ignored by osx)
dist: trusty
sudo: false
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-precise-3.9
    packages:
      - g++-5
      - gcc-5
      - g++-6
      - gcc-6
      - clang-3.8
      - clang-3.9

matrix:
  include:
    ####################################
    #           Debug builds           #
    ####################################
    # ------------ Linux ------------- #
    - os: linux
      compiler: gcc
      env: COMPILER_VERSION="5" BUILD_TYPE=Debug
    - os: linux
      compiler: gcc
      env: COMPILER_VERSION="6" BUILD_TYPE=Debug
    - os: linux
      compiler: clang
      env: COMPILER_VERSION="3.8" BUILD_TYPE=Debug
    - os: linux
      compiler: clang
      env: COMPILER_VERSION="3.9" BUILD_TYPE=Debug
    # ------------- OS X ------------- #
    - os: osx
      osx_image: xcode8
      compiler: clang
      env: BUILD_TYPE=Debug
    - os: osx
      osx_image: xcode8.1
      compiler: clang
      # bug, xcode8.1 is missing cmake, https://github.com/travis-ci/travis-ci/issues/6258
      before_install:
        - brew update
        - brew install cmake
      env: BUILD_TYPE=Debug
    - os: osx
      osx_image: xcode8.2
      compiler: clang
      env: BUILD_TYPE=Debug
    ####################################
    #          Release builds          #
    ####################################
    # ------------ Linux ------------- #
    - os: linux
      compiler: gcc
      env: COMPILER_VERSION="5" BUILD_TYPE=Release
    - os: linux
      compiler: gcc
      env: COMPILER_VERSION="6" BUILD_TYPE=Release
    - os: linux
      compiler: clang
      env: COMPILER_VERSION="3.8" BUILD_TYPE=Release
    - os: linux
      compiler: clang
      env: COMPILER_VERSION="3.9" BUILD_TYPE=Release
    # ------------- OS X ------------- #
    - os: osx
      osx_image: xcode8
      compiler: clang
      env: BUILD_TYPE=Release
    - os: osx
      osx_image: xcode8.1
      compiler: clang
      # bug, xcode8.1 is missing cmake, https://github.com/travis-ci/travis-ci/issues/6258
      before_install:
        - brew update
        - brew install cmake
      env: BUILD_TYPE=Release
    - os: osx
      osx_image: xcode8.2
      compiler: clang
      env: BUILD_TYPE=Release

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] && [ $CC == gcc ]; then export CC=gcc-$COMPILER_VERSION; export CXX=g++-$COMPILER_VERSION; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] && [ $CC == clang ]; then export CC=clang-$COMPILER_VERSION; export CXX=clang++-$COMPILER_VERSION; fi
  - mkdir build
  - cd build
  - cmake ../ -DCMAKE_BUILD_TYPE=$BUILD_TYPE
  - make -j2 
  # limiting number of workers as suggested in https://docs.travis-ci.com/user/languages/cpp/#OpenMP-projects
  - NUM_WORKERS=3 make test ARGS=-j2
